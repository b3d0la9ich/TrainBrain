{{ define "blocks/quiz.html" }}
<div id="block-{{ .ID }}" class="card glass mb-3">
  <div class="card-body">
    <h5 class="card-title">
      {{ if .Title }}{{ .Title }}{{ else }}Тест{{ end }}
    </h5>

    <div class="text-secondary small mb-2">
      Проходной балл: {{ .PassScore }}%.
      {{ if .RequirePass }}(обязателен для доступа к заданию){{ end }}
    </div>

    {{ if .Passed }}
      <div class="alert alert-success mb-0">
        Тест пройден. Лучший результат: {{ printf "%.0f" .BestScore }}%.
      </div>
    {{ else }}
      {{ if .HasLastScore }}
        <div class="alert alert-warning">
          Последний результат: {{ printf "%.0f" .LastScore }}% — попробуйте ещё раз.
        </div>
      {{ end }}

      <form method="post" action="/blocks/{{ .ID }}/quiz">
        {{ range $i, $q := .Questions }}
          <div class="border rounded p-3 mb-3">
            <div class="fw-semibold mb-2">
              Вопрос {{ add $i 1 }}. {{ $q.Text }}
            </div>

            {{ range $j, $opt := $q.Options }}
              <div class="form-check">
                <input class="form-check-input"
                       type="radio"
                       name="q-{{ $q.ID }}"
                       id="q{{ $q.ID }}o{{ $opt.ID }}"
                       value="{{ $opt.ID }}">
                <label class="form-check-label"
                       for="q{{ $q.ID }}o{{ $opt.ID }}">
                  {{ $opt.Text }}
                </label>
              </div>
            {{ end }}

          </div>
        {{ end }}

        <button class="btn btn-gradient" type="submit">
          Отправить ответы
        </button>
      </form>
    {{ end }}
  </div>
</div>
{{ end }}
