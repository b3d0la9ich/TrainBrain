{% extends "base.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<div class="container py-4">
  <h1 class="mb-3">{{ title }}</h1>
  <div class="glass p-3">
    <form method="post" novalidate>
      {{ form.hidden_tag() }}

      <div class="row g-3">
        <div class="col-md-4">
          {{ form.type.label(class="form-label") }}
          {{ form.type(class="form-select", id="type") }}
        </div>
        <div class="col-md-8">
          {{ form.title.label(class="form-label") }}
          {{ form.title(class="form-control") }}
        </div>

        <!-- TEXT -->
        <div class="col-12 for-text">
          {{ form.text.label(class="form-label") }}
          {{ form.text(class="form-control", rows="8", placeholder="Можно обычный текст или Markdown: **жирный**, списки, ```код``` и т.п.") }}
          <div class="form-text">Используется в блоке типа «Текст». Поддерживается Markdown.</div>
        </div>

        <!-- VIDEO -->
        <div class="col-md-6 for-video">
          {{ form.url.label(class="form-label") }}
          {{ form.url(class="form-control") }}
          <div class="form-text">Embed URL (YouTube/Vimeo)</div>
        </div>
        <div class="col-md-6 for-video">
          {{ form.src.label(class="form-label") }}
          {{ form.src(class="form-control") }}
          <div class="form-text">Прямой MP4</div>
        </div>
        <div class="col-12 for-video">
          {{ form.caption.label(class="form-label") }}
          {{ form.caption(class="form-control") }}
        </div>

        <!-- ASSIGNMENT -->
        <div class="col-12 for-assignment">
          {{ form.instructions.label(class="form-label") }}
          {{ form.instructions(class="form-control", rows="4") }}
          <div class="form-text">Инструкции для задания</div>
        </div>
      </div>

      <div class="mt-3">
        {{ form.submit(class="btn btn-gradient") }}
        <a class="btn btn-outline-secondary ms-2" href="{{ url_for('admin.course_edit', course_id=module.course_id) }}">Назад к курсу</a>
      </div>
    </form>
  </div>
</div>

<script>
(function() {
  const $type = document.getElementById('type');
  const show = sel => document.querySelectorAll(sel).forEach(e => e.style.display = '');
  const hide = sel => document.querySelectorAll(sel).forEach(e => e.style.display = 'none');

  function toggleByType() {
    const t = $type.value;
    hide('.for-text, .for-video, .for-assignment');
    if (t === 'text') show('.for-text');
    if (t === 'video') show('.for-video');
    if (t === 'assignment') show('.for-assignment');
  }

  document.addEventListener('DOMContentLoaded', toggleByType);
  $type.addEventListener('change', toggleByType);
})();
</script>
{% endblock %}
