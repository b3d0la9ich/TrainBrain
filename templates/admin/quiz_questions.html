{% extends "base.html" %}
{% block title %}Тест: {{ block.payload.get('title','Тест') }}{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="mb-0">Тест: {{ block.payload.get('title','Тест') }}</h1>
    <a class="btn btn-outline-secondary" href="{{ url_for('admin.course_edit', course_id=block.module.course_id) }}">← К курсу</a>
  </div>

  <div class="alert alert-light border">
    Проходной балл: <strong>{{ block.payload.get('pass_score',70) }}%</strong> ·
    Требовать прохождение: <strong>{{ 'Да' if block.payload.get('require_pass', True) else 'Нет' }}</strong>
  </div>

  <a href="{{ url_for('admin.quiz_question_new', block_id=block.id) }}" class="btn btn-primary mb-3">+ Вопрос</a>

  {% for q in block.quiz_questions %}
    <div class="border rounded p-3 mb-3">
      <div class="d-flex justify-content-between align-items-start">
        <div><strong>#{{ q.order }}</strong> — {{ q.text }}</div>
        <form method="post" action="{{ url_for('admin.quiz_question_delete', question_id=q.id) }}" onsubmit="return confirm('Удалить вопрос?')">
          <button class="btn btn-sm btn-outline-danger">×</button>
        </form>
      </div>
      <div class="mt-2">
        <div class="fw-semibold">Варианты:</div>
        {% for o in q.options %}
          <div class="d-flex justify-content-between align-items-center border rounded p-2 mb-2">
            <div>{% if o.is_correct %}<span class="badge bg-success me-1">верный</span>{% endif %} {{ o.text }}</div>
            <form method="post" action="{{ url_for('admin.quiz_option_delete', option_id=o.id) }}">
              <button class="btn btn-sm btn-outline-danger">×</button>
            </form>
          </div>
        {% else %}
          <div class="text-muted">Нет вариантов</div>
        {% endfor %}
      </div>
      <form class="row g-2 mt-2" method="post" action="{{ url_for('admin.quiz_option_new', question_id=q.id) }}">
        <div class="col-md-8">
          <input class="form-control" name="text" placeholder="Текст варианта">
        </div>
        <div class="col-md-2">
          <div class="form-check mt-2">
            <input class="form-check-input" type="checkbox" name="is_correct" id="c{{ q.id }}">
            <label class="form-check-label" for="c{{ q.id }}">Верный</label>
          </div>
        </div>
        <div class="col-md-2">
          <button class="btn btn-secondary w-100">Добавить</button>
        </div>
      </form>
    </div>
  {% else %}
    <div class="text-muted">Вопросов ещё нет.</div>
  {% endfor %}
</div>
{% endblock %}
