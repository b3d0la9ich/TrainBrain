{{define "admin/course_form.html"}}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>{{.title}} — Панель администратора</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/admin/">TrainBrain Admin</a>
    <div class="ms-auto d-flex gap-2">
      <a class="btn btn-outline-light btn-sm" href="/">На сайт</a>
      <a class="btn btn-outline-warning btn-sm" href="/logout">Выйти</a>
    </div>
  </div>
</nav>

<div class="container py-4">

  <div class="mb-3">
    <h1 class="h3 mb-0">{{.title}}</h1>
    {{if .course}}
    {{end}}
  </div>

  {{if .Error}}
    <div class="alert alert-danger">{{.Error}}</div>
  {{end}}

  <!-- ФОРМА КУРСА -->
  <div class="card mb-4">
    <div class="card-body">
      <form method="post">
        <div class="mb-3">
          <label class="form-label">Название курса</label>
          <input type="text" name="title" class="form-control"
                 value="{{if .course}}{{.course.Title}}{{end}}" required>
        </div>

        <div class="mb-3">
          <label class="form-label">Краткое описание</label>
          <textarea name="short_desc" class="form-control" rows="3">{{if .course}}{{.course.ShortDesc}}{{end}}</textarea>
        </div>

        <div class="mb-3">
          <label class="form-label">Статус</label>
          <select name="status" class="form-select">
            <option value="draft"
              {{if or (not .course) (eq .course.Status "draft")}}selected{{end}}>
              Черновик
            </option>
            <option value="published"
              {{if and .course (eq .course.Status "published")}}selected{{end}}>
              Опубликован
            </option>
          </select>
        </div>

        <button type="submit" class="btn btn-primary">
          <i class="bi bi-save me-1"></i> Сохранить
        </button>
        <a href="/admin/courses" class="btn btn-outline-secondary ms-2">К списку курсов</a>
      </form>
    </div>
  </div>

  {{if .course}}
  <!-- МОДУЛИ КУРСА -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="h4 mb-0">Модули курса</h2>
    <a href="/admin/courses/{{.course.ID}}/modules/new" class="btn btn-sm btn-success">
      <i class="bi bi-plus-lg me-1"></i> Добавить модуль
    </a>
  </div>

  {{if .course.Modules}}
    <div class="accordion" id="modulesAccordion">
      {{range $i, $m := .course.Modules}}
        <div class="accordion-item mb-2">
          <h2 class="accordion-header" id="heading-{{$m.ID}}">
            <button class="accordion-button collapsed" type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapse-{{$m.ID}}"
                    aria-expanded="false"
                    aria-controls="collapse-{{$m.ID}}">
              <span class="me-2 text-muted">#{{$m.Order}}</span>
              {{$m.Title}}
            </button>
          </h2>
          <div id="collapse-{{$m.ID}}" class="accordion-collapse collapse"
               aria-labelledby="heading-{{$m.ID}}"
               data-bs-parent="#modulesAccordion">
            <div class="accordion-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <div class="text-muted">
                  Блоков: {{len $m.Blocks}}
                </div>
                <div class="btn-group">
                  <a href="/admin/modules/{{$m.ID}}/edit"
                     class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-pencil"></i> Редактировать модуль
                  </a>
                  <form method="post"
                        action="/admin/modules/{{$m.ID}}/delete"
                        onsubmit="return confirm('Удалить модуль {{$m.Title}}?');">
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                      <i class="bi bi-trash"></i>
                    </button>
                  </form>
                </div>
              </div>

              <hr>

              <div class="d-flex justify-content-between align-items-center mb-2">
                <h3 class="h6 mb-0">Блоки модуля</h3>
                <a href="/admin/modules/{{$m.ID}}/blocks/new"
                   class="btn btn-sm btn-outline-success">
                  <i class="bi bi-plus-lg"></i> Добавить блок
                </a>
              </div>

              {{if $m.Blocks}}
                <div class="table-responsive">
                  <table class="table table-sm align-middle mb-0">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Тип</th>
                        <th>Заголовок</th>
                        <th class="text-end">Действия</th>
                      </tr>
                    </thead>
                    <tbody>
                    {{range $m.Blocks}}
                      <tr>
                        <td>{{.Order}}</td>
                        <td>
                          {{if eq .Type "text"}}Текст
                          {{else if eq .Type "video"}}Видео
                          {{else if eq .Type "quiz"}}Тест
                          {{else if eq .Type "assignment"}}Задание
                          {{else}}{{.Type}}{{end}}
                        </td>
                        <td>{{.ID}}</td>

                        <td class="text-end">

                          {{if eq .Type "quiz"}}
                            <a href="/admin/quizzes/{{.ID}}"
                               class="btn btn-sm btn-outline-success me-1">
                              <i class="bi bi-question-circle"></i> Вопросы
                            </a>
                          {{end}}

                          <a href="/admin/blocks/{{.ID}}/edit"
                             class="btn btn-sm btn-outline-primary me-1">
                            <i class="bi bi-pencil"></i>
                          </a>

                          <form method="post"
                                action="/admin/blocks/{{.ID}}/delete"
                                class="d-inline"
                                onsubmit="return confirm('Удалить блок?');">
                            <button type="submit"
                                    class="btn btn-sm btn-outline-danger">
                              <i class="bi bi-trash"></i>
                            </button>
                          </form>
                        </td>
                      </tr>
                    {{end}}
                    </tbody>
                  </table>
                </div>
              {{else}}
                <div class="text-muted">
                  В этом модуле ещё нет блоков.
                </div>
              {{end}}
            </div>
          </div>
        </div>
      {{end}}
    </div>
  {{else}}
    <div class="alert alert-info">
      В этом курсе пока нет модулей. Нажми «Добавить модуль».
    </div>
  {{end}}
  {{end}}

  <a href="/admin/courses" class="btn btn-link mt-4">&larr; К списку курсов</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
{{end}}
