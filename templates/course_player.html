{% extends "base.html" %}
{% block title %}{{ course.title }}{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h1 class="mb-0">{{ course.title }}</h1>
    <a href="{{ url_for('course.list_courses') }}" class="btn btn-outline-secondary">← Ко всем курсам</a>
  </div>
  {% if course.description %}<p class="text-secondary">{{ course.description }}</p>{% endif %}

  {% for m in course.modules %}
    <h3 class="mt-4">Модуль #{{ m.order }}: {{ m.title }}</h3>

    {% if m.blocks %}
      {% set others = m.blocks | rejectattr('type','equalto','quiz') | list %}
      {% for b in others %}
        {% if b.type == 'text' %}
          {% include 'blocks/text.html' %}
        {% elif b.type == 'video' %}
          {% include 'blocks/video.html' %}
        {% elif b.type == 'assignment' %}
          {% include 'blocks/assignment.html' %}
        {% else %}
          <div class="alert alert-warning">Неизвестный тип блока: {{ b.type }}</div>
        {% endif %}
      {% endfor %}

      {% set quizzes = m.blocks | selectattr('type','equalto','quiz') | list %}
      {% for b in quizzes %}
        {% include 'blocks/quiz.html' %}
      {% endfor %}
    {% else %}
      <div class="text-secondary">В модуле нет блоков.</div>
    {% endif %}
  {% else %}
    <div class="text-secondary">Модулей пока нет.</div>
  {% endfor %}
</div>

<script>
(function () {
  const OFFSET = 70;
  function go() {
    if (!location.hash) return;
    const el = document.getElementById(location.hash.slice(1));
    if (!el) return;
    const y = el.getBoundingClientRect().top + window.pageYOffset - OFFSET;
    window.scrollTo({ top: y, behavior: 'smooth' });
  }
  window.addEventListener('load', go);
  window.addEventListener('hashchange', go);
})();
</script>
{% endblock %}
